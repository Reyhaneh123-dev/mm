<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ â€” Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„</title>
<style>
  :root{--accent:#0077cc;--accent2:#ff9800;--danger:#b00020;--muted:#666}
  body{font-family: 'Vazir', Tahoma, sans-serif;background:#f4f8fb;padding:18px;color:#222}
  .container{max-width:980px;margin:0 auto}
  .card{background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 6px 20px rgba(0,0,0,0.05)}
  h1{color:var(--accent);text-align:center;margin-bottom:6px}
  h2{color:var(--accent);margin:0 0 6px 0}
  label{display:block;margin-top:10px;font-weight:600}
  select,input[type=text],textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px;margin-top:6px;box-sizing:border-box;font-family:inherit}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .small{font-size:13px;color:var(--muted);margin-top:6px}
  button{padding:10px 12px;border-radius:8px;border:none;cursor:pointer;color:#fff;background:var(--accent);font-weight:600}
  button.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent)}
  button.warn{background:var(--accent2)}
  .inline{display:inline-block}
  #formulaA,#mathA,#membersA,#vennA,#axisA,#resultC,#membersC,#vennC,#axisC{margin-top:10px;padding:10px;border-radius:8px;background:#f0f6ff;direction:ltr}
  svg text{font-size:13px}
  .hidden{display:none}
  .note{background:#fff8e6;border-left:4px solid #ffd166;padding:8px;border-radius:6px;color:#6b4f00;margin-top:8px}
  pre{background:#fafafa;padding:8px;border-radius:6px;overflow:auto}
  .flex-between{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .muted{color:#666;font-size:13px}
  .danger{color:var(--danger)}
  .big {padding:12px 16px;font-size:16px;background:var(--accent2);display:block;width:100%;margin-top:12px}
  .kbd{background:#f1f1f1;padding:2px 6px;border-radius:4px;border:1px solid #e6e6e6}
  .box{border:1px dashed #ddd;padding:8px;border-radius:8px;background:#fff}
  .center{text-align:center}
</style>
</head>
<body>
<div class="container">

  <h1>Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ â€” Ù†Ø³Ø®Ù‡Ù” ØªÚ©â€ŒØµÙØ­Ù‡â€ŒØ§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>

  <!-- Ø¨Ø®Ø´ A -->
  <div class="card" id="cardA">
    <h2>Ø¨Ø®Ø´ Û± â€” ØªØ¹Ø±ÛŒÙ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” A</h2>

    <label>Û±. Ù…Ø¬Ù…ÙˆØ¹Ù‡ A Ø¹Ø¶Ùˆ Ú©Ø¯Ø§Ù… Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ Ø§Ø³ØªØŸ</label>
    <select id="baseA">
      <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
      <option value="N">â„• â€” Ø§Ø¹Ø¯Ø§Ø¯ Ø·Ø¨ÛŒØ¹ÛŒ</option>
      <option value="Z">â„¤ â€” Ø§Ø¹Ø¯Ø§Ø¯ ØµØ­ÛŒØ­</option>
      <option value="W">ğ• â€” Ø§Ø¹Ø¯Ø§Ø¯ Ø­Ø³Ø§Ø¨ÛŒ (Ø´Ø§Ù…Ù„ Û°)</option>
      <option value="Q">â„š â€” Ø§Ø¹Ø¯Ø§Ø¯ Ú¯ÙˆÛŒØ§</option>
      <option value="R">â„ â€” Ø§Ø¹Ø¯Ø§Ø¯ Ø­Ù‚ÛŒÙ‚ÛŒ</option>
      <option value="irr">Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯ (irrational)</option>
    </select>

    <label>Û². Ø§Ú¯Ø± Ø´Ø±Ø· Ø¯Ø§Ø±ÛŒØ¯ (Ø¨Ù‡ Ø²Ø¨Ø§Ù† Ú©Ù„Ø§Ù…ÛŒ) Ø¢Ù† Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ â€” Ø³Ù¾Ø³ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯:</label>
    <input id="condA" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ú©Ù…ØªØ± Ø§Ø² 10 ÛŒØ§ Ø¨ÛŒÙ† 1 Ùˆ 5 ÛŒØ§ Ø²ÙˆØ¬ ÛŒØ§ Ù…Ø¶Ø±Ø¨ 3">

    <div class="row">
      <button id="btnBuildA">Ø³Ø§Ø®Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡ A (Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´)</button>
      <button id="btnShowMathA" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ</button>
      <button id="btnShowMembersA" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§</button>
      <button id="btnShowVennA" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆØ¯Ø§Ø± ÙˆÙ†</button>
      <button id="btnShowAxisA" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒ Ù…Ø­ÙˆØ±</button>
      <button id="btnToOps" class="big">Ø§Ù†Ø¬Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÛŒØ§Ø¶ÛŒ â†’</button>
    </div>

    <div id="formulaA" class="box">A Ù‡Ù†ÙˆØ² Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
    <div id="mathA" class="box hidden"></div>
    <div id="membersA" class="box hidden"></div>
    <div id="vennA" class="box hidden center"></div>
    <div id="axisA" class="box hidden"></div>

    <div class="note">ØªØ¨Ø¯ÛŒÙ„ Ø´Ø±Ø· Ú©Ù„Ø§Ù…ÛŒ Ø¨Ù‡ Ø±ÛŒØ§Ø¶ÛŒ: Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù…ØªØ¯Ø§ÙˆÙ„ Ù¾ÙˆØ´Ø´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯: Â«Ú©Ù…ØªØ± Ø§Ø²Â»ØŒ Â«Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø²Â»ØŒ Â«Ú©ÙˆÚ†Ú©ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒÂ»ØŒ Â«Ø¨ÛŒÙ† ... Ùˆ ...Â»ØŒ Â«Ø²ÙˆØ¬/ÙØ±Ø¯Â»ØŒ Â«ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± kÂ» Ùˆ Ù†ÙˆØ´ØªØ§Ø± Ú©ÙˆØªØ§Ù‡ x &lt; 5 Ùˆ ...</div>
  </div>

  <!-- Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§Øª (B Ùˆ Ù†ØªØ§ÛŒØ¬) -->
  <div class="card hidden" id="cardOps">
    <h2>Ø¨Ø®Ø´ Û² â€” Ø§Ù†Ø¬Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÛŒØ§Ø¶ÛŒ Ø±ÙˆÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§</h2>

    <div class="muted">Ø¯Ø± Ø¨Ø§Ù„Ø§: <strong>Ù…Ø¬Ù…ÙˆØ¹Ù‡ A</strong> (Ø«Ø§Ø¨Øª â€” Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø² Ø¨Ø®Ø´ Ø§ÙˆÙ„ Ù†ÛŒØ³Øª)</div>
    <div id="showA" class="box"></div>

    <hr>

    <label>Ø±ÙˆØ´ Ø³Ø§Ø®Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</label>
    <select id="methodB">
      <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
      <option value="symbolic">Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ</option>
      <option value="members">Ù†ÙˆØ´ØªÙ† Ø§Ø¹Ø¶Ø§</option>
      <option value="known">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡</option>
    </select>

    <div id="areaB" class="box" style="margin-top:10px">
      <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø±Ø§ÛŒ B Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ -->
      <div class="small">Ø±ÙˆØ´ Ø³Ø§Ø®Øª B Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯.</div>
    </div>

    <label style="margin-top:12px">Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</label>
    <select id="opSelect">
      <option value="union">Ø§Ø¬ØªÙ…Ø§Ø¹ (âˆª)</option>
      <option value="intersection">Ø§Ø´ØªØ±Ø§Ú© (âˆ©)</option>
      <option value="difference">ØªÙØ§Ø¶Ù„ (âˆ’)</option>
      <option value="subset">Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡ (âŠ†)</option>
      <option value="member">Ø¹Ø¶Ùˆ Ø¨ÙˆØ¯Ù† (âˆˆ)</option>
    </select>

    <div class="row" style="margin-top:10px">
      <button id="btnCompute">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡</button>
      <button id="btnShowMathC" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ C</button>
      <button id="btnShowMembersC" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§ÛŒ C</button>
      <button id="btnShowVennC" class="ghost">Ù†Ù…Ø§ÛŒØ´ ÙˆÙ† Ø¨Ø±Ø§ÛŒ C</button>
      <button id="btnShowAxisC" class="ghost">Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ C</button>
    </div>

    <div id="resultC" class="box" style="margin-top:10px"></div>
    <div id="membersC" class="box hidden"></div>
    <div id="vennC" class="box hidden center"></div>
    <div id="axisC" class="box hidden"></div>

  </div>

</div>

<script>
/* ---------- Ú©Ù…Ú©ÛŒâ€ŒÙ‡Ø§ ---------- */
function toPersian(s){
  return String(s).replace(/[0-9]/g, d=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[d]);
}
function isNumeric(n){ return !isNaN(parseFloat(n)) && isFinite(n); }

/* Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§) */
const baseSamples = {
  N: (limit=20)=>Array.from({length:limit},(_,i)=>i+1),
  W: (limit=20)=>Array.from({length:limit},(_,i)=>i),
  Z: (limit=21)=>{ const arr=[]; for(let i=-10;i<=10;i++) arr.push(i); return arr; },
  Q: ()=>null,
  R: ()=>null,
  irr: ()=>null
};

/* ØªØ¨Ø¯ÛŒÙ„ Ø´Ø±Ø· Ú©Ù„Ø§Ù…ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø´ÛŒÙ” Ø´Ø±Ø· Ùˆ Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ Ø³Ø§Ø¯Ù‡ */
function parsePersianCondition(text){
  if(!text) return {ok:false, err:'Ø´Ø±Ø·ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡', predicate:null, symbolic:null, meta:{}};
  const t = text.trim().toLowerCase();

  // Ø¨ÛŒÙ† a Ùˆ b
  let m = t.match(/Ø¨ÛŒÙ†\s*(-?\d+)\s*(?:Ùˆ|ØªØ§)\s*(-?\d+)/);
  if(m){ const a=Number(m[1]), b=Number(m[2]); return {ok:true, predicate:x=>x>=Math.min(a,b) && x<=Math.max(a,b), symbolic:`${Math.min(a,b)} \\le x \\le ${Math.max(a,b)}`, meta:{type:'interval', a:Math.min(a,b), b:Math.max(a,b), inclusiveBoth:true}}; }

  // Ú©ÙˆÚ†Ú©ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ / Ø¨Ø²Ø±Ú¯ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ
  m = t.match(/Ú©ÙˆÚ†Ú©ØªØ±\s*ÛŒØ§\s*Ù…Ø³Ø§ÙˆÛŒ\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x<=n, symbolic:`x \\le ${n}`, meta:{type:'lte', n, inclusive:true}}; }
  m = t.match(/Ø¨Ø²Ø±Ú¯ØªØ±\s*ÛŒØ§\s*Ù…Ø³Ø§ÙˆÛŒ\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x>=n, symbolic:`x \\ge ${n}`, meta:{type:'gte', n, inclusive:true}}; }

  // Ú©ÙˆÚ†Ú©ØªØ± / Ø¨Ø²Ø±Ú¯ØªØ±
  m = t.match(/Ú©ÙˆÚ†Ú©ØªØ±\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x< n, symbolic:`x < ${n}`, meta:{type:'lt', n, inclusive:false}}; }
  m = t.match(/Ø¨Ø²Ø±Ú¯ØªØ±\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x> n, symbolic:`x > ${n}`, meta:{type:'gt', n, inclusive:false}}; }

  // Ø²ÙˆØ¬ / ÙØ±Ø¯
  if(/\bØ²ÙˆØ¬\b/.test(t)){ return {ok:true, predicate:x=>Number.isInteger(x) && x%2===0, symbolic:`x \\text{ Ø²ÙˆØ¬}`, meta:{type:'parity', parity:'even'}}; }
  if(/\bÙØ±Ø¯\b/.test(t)){ return {ok:true, predicate:x=>Number.isInteger(x) && Math.abs(x%2)===1, symbolic:`x \\text{ ÙØ±Ø¯}`, meta:{type:'parity', parity:'odd'}}; }

  // ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± k
  m = t.match(/ØªÙ‚Ø³ÛŒÙ…\s*Ø¨Ø±\s*(\d+)/);
  if(m){ const k=Number(m[1]); return {ok:true, predicate:x=>Number.isInteger(x) && x%k===0, symbolic:`x \\equiv 0 \\ (\\mathrm{mod}\\ ${k})`, meta:{type:'div', k}}; }

  // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ x<5 ÛŒØ§ x<=5
  m = t.match(/x\s*<=\s*(-?\d+)/) || t.match(/x\s*â‰¤\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x<=n, symbolic:`x \\le ${n}`, meta:{type:'lte', n, inclusive:true}}; }
  m = t.match(/x\s*<\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x< n, symbolic:`x < ${n}`, meta:{type:'lt', n, inclusive:false}}; }
  m = t.match(/x\s*>=\s*(-?\d+)/) || t.match(/x\s*â‰¥\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x>=n, symbolic:`x \\ge ${n}`, meta:{type:'gte', n, inclusive:true}}; }
  m = t.match(/x\s*>\s*(-?\d+)/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x> n, symbolic:`x > ${n}`, meta:{type:'gt', n, inclusive:false}}; }

  // Ø¹Ø¯Ø¯ ÙˆØ§Ø­Ø¯
  m = t.match(/^(-?\d+)$/);
  if(m){ const n=Number(m[1]); return {ok:true, predicate:x=>x===n, symbolic:`x = ${n}`, meta:{type:'equal', n}}; }

  return {ok:false, err:'Ù‚Ø§Ø¯Ø± Ø¨Ù‡ ØªØ¨Ø¯ÛŒÙ„ Ø´Ø±Ø· Ø¨Ù‡ Ø´Ú©Ù„ Ø±ÛŒØ§Ø¶ÛŒØ§ØªÛŒ Ù†Ø´Ø¯Ù… â€” Ù„Ø·ÙØ§Ù‹ Ø´Ø±Ø· Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: Â«Ú©ÙˆÚ†Ú©ØªØ± Ø§Ø² ÛµÂ» ÛŒØ§ Â«Ø¨ÛŒÙ† 1 Ùˆ 5Â» ÛŒØ§ Â«Ø²ÙˆØ¬Â»).', predicate:null, symbolic:null, meta:{}};
}

/* ---------- ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ---------- */
let A = { name:'A', base:null, condText:'', symbolic:null, members:null, condMeta:null };

/* ---------- ØªÙˆØ§Ø¨Ø¹ UI Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ A ---------- */
const baseA = document.getElementById('baseA');
const condA = document.getElementById('condA');
const btnBuildA = document.getElementById('btnBuildA');
const btnShowMathA = document.getElementById('btnShowMathA');
const btnShowMembersA = document.getElementById('btnShowMembersA');
const btnShowVennA = document.getElementById('btnShowVennA');
const btnShowAxisA = document.getElementById('btnShowAxisA');
const formulaA = document.getElementById('formulaA');
const mathA = document.getElementById('mathA');
const membersA = document.getElementById('membersA');
const vennA = document.getElementById('vennA');
const axisA = document.getElementById('axisA');
const cardOps = document.getElementById('cardOps');
const btnToOps = document.getElementById('btnToOps');
const showA = document.getElementById('showA');

/* Ø³Ø§Ø®Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” A (Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù†Ù…Ø§Ø¯) */
function buildA(){
  const base = baseA.value;
  const condText = condA.value.trim();
  if(!base){ alert('Ø§Ø¨ØªØ¯Ø§ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ø§ÛŒ A Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.'); return; }

  A.base = base;
  A.condText = condText;

  // ØªØ¨Ø¯ÛŒÙ„ Ø´Ø±Ø·
  let parsed = {ok:false};
  if(condText) parsed = parsePersianCondition(condText);
  else parsed = {ok:false};

  // Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ
  if(base==='irr') {
    A.symbolic = `A = \\{ x \\in \\text{Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯} \\ ${condText? `\\mid ${parsed.symbolic||condText}` : ''}\\ }`;
  } else {
    A.symbolic = condText ? `A = { x âˆˆ ${base} | ${parsed.symbolic || condText} }` : `A = { x âˆˆ ${base} }`;
  }

  // Ø§Ø¹Ø¶Ø§: ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ N, W, Z ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  if(['N','W','Z'].includes(base)){
    // Ø§Ú¯Ø± Ø´Ø±Ø· Ù‚Ø§Ø¨Ù„ ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯ØŒ ÙÛŒÙ„ØªØ± Ù†Ù…ÙˆÙ†Ù‡ Ø±Ø§ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    let sample = baseSamples;
    if(parsed.ok && parsed.predicate){
      const members = sample.filter(parsed.predicate);
      A.members = members;
      A.condMeta = parsed.meta||null;
    } else {
      A.members = sample;
      A.condMeta = parsed.meta||null;
    }
  } else {
    // Q, R, irr => Ù†Ø§ØªÙˆØ§Ù† Ø¯Ø± Ø´Ù…Ø±Ø¯Ù† Ø§Ø¹Ø¶Ø§
    A.members = null;
    A.condMeta = parsed.meta||null;
  }

  // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§Ø¯ Ø®Ù„Ø§ØµÙ‡ Ø¯Ø± Ø¨Ø®Ø´ formulaA
  formulaA.innerHTML = `<strong>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§Ø¯:</strong> <div style="margin-top:6px;direction:ltr">${A.symbolic}</div>`;
  mathA.classList.add('hidden'); membersA.classList.add('hidden'); vennA.classList.add('hidden'); axisA.classList.add('hidden');
  // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ A Ø«Ø§Ø¨Øª Ø¯Ø± Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§Øª
  showA.innerHTML = `<strong>A =</strong> <span style="direction:ltr">${condText ? A.symbolic : (A.members ? ('{ ' + A.members.slice(0,20).join(', ') + (A.members.length>20 ? ', ...' : '') + ' }') : '{ ... }')}</span>`;
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ A */
btnBuildA.addEventListener('click', ()=>{ buildA(); });
btnShowMathA.addEventListener('click', ()=>{
  if(!A.symbolic) { alert('Ø§Ø¨ØªØ¯Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ A Ø±Ø§ Ø¨Ø³Ø§Ø²'); return; }
  mathA.classList.remove('hidden'); mathA.innerHTML = `<pre>${A.symbolic}</pre>`;
});
btnShowMembersA.addEventListener('click', ()=>{
  if(A.members===null){ membersA.classList.remove('hidden'); membersA.innerHTML = `<div class="danger">Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø§ÛŒÙ†Ú©Ù‡ Ø¹Ø¶Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ ${A.base==='Q'?'Ú¯ÙˆÛŒØ§':(A.base==='R'?'Ø­Ù‚ÛŒÙ‚ÛŒ':'Ú¯Ù†Ú¯')} Ø§Ø³ØªØŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª.</div>`; return; }
  membersA.classList.remove('hidden'); membersA.innerHTML = `<div><strong>A = </strong>{ ${A.members.map(toPersian).join(', ')} }</div>`;
});
btnShowVennA.addEventListener('click', ()=>{
  vennA.classList.remove('hidden'); 
  if(!A.members || A.members.length===0){ vennA.innerHTML = `<div class="danger">Ø§Ù…Ú©Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆØ¯Ø§Ø± ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ (Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ ÛŒØ§ ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´).</div>`; return; }
  // Ø±Ø³Ù… ÛŒÚ© Ø¯Ø§ÛŒØ±Ù‡ Ùˆ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø§Ø¹Ø¶Ø§ Ø±ÙˆÛŒ Ù…Ø­ÛŒØ·
  const members = A.members.slice(0,30);
  const cx=150, cy=90, r=70;
  let texts='';
  const angleStep = 360/members.length;
  members.forEach((v,i)=>{
    const angle = (angleStep*i-90) * Math.PI/180;
    const x = cx + r*Math.cos(angle);
    const y = cy + r*Math.sin(angle);
    texts += `<text x="${x}" y="${y+4}">${toPersian(v)}</text>`;
  });
  vennA.innerHTML = `<svg width="320" height="200"><circle cx="${cx}" cy="${cy}" r="${r}" stroke="#0077cc" fill="rgba(0,119,204,0.12)"/>${texts}</svg>`;
});
btnShowAxisA.addEventListener('click', ()=>{
  axisA.classList.remove('hidden');
  axisA.innerHTML = '';
  if(A.members===null || A.members.length===0){
    axisA.innerHTML = `<div class="danger">Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ (${A.base==='Q'?'Ú¯ÙˆÛŒØ§':(A.base==='R'?'Ø­Ù‚ÛŒÙ‚ÛŒ':'Ú¯Ù†Ú¯')}) Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª.</div>`;
    return;
  }
  // Ù…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ N,W,Z
  if(['N','W','Z'].includes(A.base)){
    const first = A.members[0], last = A.members[A.members.length-1];
    // Ø§Ú¯Ø± Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù† Ø³Ù…Øª Ø±Ø§Ø³Øª ÛŒØ§ Ú†Ù¾ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ø¨Ø±Ø§Ø³Ø§Ø³ condMeta ØªØ´Ø®ÛŒØµ Ø¯Ù‡ÛŒÙ…
    const meta = A.condMeta || {};
    let leftOpen=false, rightOpen=false;
    if(meta.type==='lt' && meta.n===last) rightOpen=true;
    if(meta.type==='gt' && meta.n===first) leftOpen=true;
    if(meta.type==='interval' && meta.a===first && meta.b===last && (!meta.inclusiveBoth)){ rightOpen=true; leftOpen=true; }

    // Ø±Ø³Ù…
    let points='';
    const width=760;
    const totalSpan = last - first || 1;
    A.members.forEach(v=>{
      const pos = ((v - first)/totalSpan)*90 + 5; // Ø¯Ø±ØµØ¯
      points += `<div style="position:absolute;left:${pos}%;top:6px;text-align:center;">â—<div style="font-size:12px">${toPersian(v)}</div></div>`;
    });
    // Ú©Ø§Ø¯Ø± Ø§Ø² Ø§ÙˆÙ„ ØªØ§ Ø¢Ø®Ø±
    const leftArrow = leftOpen ? '<span style="font-size:20px">â—‚</span>' : '';
    const rightArrow = rightOpen ? '<span style="font-size:20px">â–¸</span>' : '';
    axisA.innerHTML = `<div style="position:relative;height:70px;border-top:2px solid #333;padding-top:6px;">
        ${points}
        <div style="position:absolute;left:5%;right:5%;top:35px;text-align:center;color:#444">${leftArrow} <span style="display:inline-block;border:1px solid #aaa;padding:6px;border-radius:6px;background:#fff">Ø§Ø² ${toPersian(first)} ØªØ§ ${toPersian(last)}</span> ${rightArrow}</div>
      </div>`;
    return;
  }

  // Ø¨Ø±Ø§ÛŒ R: ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ ÛŒØ§ Ù†Ù‚Ø§Ø· Ø±Ø§ Ù†Ø´Ø§Ù† Ø¯Ù‡ÛŒÙ…
  // Ø§Ú¯Ø± Ø´Ø±Ø· Ø¨Ø±Ø§Ø¨Ø± Ø¨Ù‡ ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯ (meta.equal) => Ø¯Ø§ÛŒØ±Ù‡ Ù¾Ø± Ø¯Ø± Ø¢Ù† Ø¹Ø¯Ø¯
  const meta = A.condMeta || {};
  if(meta.type==='equal'){
    const n = meta.n;
    axisA.innerHTML = `<div style="height:60px;border-top:2px solid #333;position:relative;">
      <div style="position:absolute;left:50%;top:0;transform:translateX(-50%);font-size:18px;">â—</div>
      <div style="position:absolute;left:50%;top:24px;transform:translateX(-50%);font-size:12px">${toPersian(n)}</div>
    </div>`;
    return;
  }
  if(meta.type==='interval'){
    // Ø¨Ø§Ø²Ù‡ Ø¨ÛŒÙ† a Ùˆ b â€” Ø±Ø³Ù… Ø®Ø· Ø§ÙÙ‚ÛŒ Ø¨Ø§ Ù…Ø±Ø²Ù‡Ø§ÛŒ Ù¾Ø± ÛŒØ§ Ø®Ø§Ù„ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ inclusive
    const a=meta.a,b=meta.b;
    const leftChar = meta.inclusiveLeft? 'â—' : 'â—‹';
    const rightChar = meta.inclusiveRight? 'â—' : 'â—‹';
    axisA.innerHTML = `<div style="height:60px;border-top:2px solid #333;position:relative;">
      <div style="position:absolute;left:20%;top:0">${leftChar}<div style="font-size:12px">${toPersian(a)}</div></div>
      <div style="position:absolute;left:80%;top:0">${rightChar}<div style="font-size:12px">${toPersian(b)}</div></div>
      <div style="position:absolute;left:20%;right:20%;top:12px;border-top:2px solid #333"></div>
    </div>`;
    return;
  }
  // fallback: Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡ Ù†Ù‚Ø§Ø· Ø¨Ø§ Ø¯Ø§ÛŒØ±Ù‡ ØªÙˆØ®Ø§Ù„ÛŒ/ØªÙˆÙ¾Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ integer check
  axisA.innerHTML = `<div style="height:60px;border-top:2px solid #333;position:relative;">
    <div style="position:absolute;left:10%;top:0">â—‹<div style="font-size:12px">...</div></div>
    <div style="position:absolute;left:50%;top:0">â—‹<div style="font-size:12px">...</div></div>
    <div style="position:absolute;left:90%;top:0">â—‹<div style="font-size:12px">...</div></div>
  </div>`;
});

/* Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§Øª */
btnToOps.addEventListener('click', ()=>{
  if(!A.base){ alert('Ø§Ø¨ØªØ¯Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ A Ø±Ø§ Ø¨Ø³Ø§Ø²'); return; }
  cardOps.classList.remove('hidden');
  // Ø«Ø§Ø¨Øªâ€ŒØ³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ A
  showA.innerHTML = `<strong>A = </strong> <span style="direction:ltr">${A.symbolic ? A.symbolic : (A.members ? '{ ' + A.members.slice(0,20).map(toPersian).join(', ') + (A.members.length>20? ', ...' : '') + ' }' : '{ ... }')}</span>`;
  // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§Øª
  document.getElementById('cardOps').scrollIntoView({behavior:'smooth'});
});

/* ---------- Ø¨Ø®Ø´ B (ØªØ¹Ø±ÛŒÙ B Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø¹Ù…Ù„ÛŒØ§Øª) ---------- */
const methodB = document.getElementById('methodB');
const areaB = document.getElementById('areaB');
const opSelect = document.getElementById('opSelect');
const btnCompute = document.getElementById('btnCompute');
const btnShowMathC = document.getElementById('btnShowMathC');
const btnShowMembersC = document.getElementById('btnShowMembersC');
const btnShowVennC = document.getElementById('btnShowVennC');
const btnShowAxisC = document.getElementById('btnShowAxisC');
const resultC = document.getElementById('resultC');
const membersC = document.getElementById('membersC');
const vennC = document.getElementById('vennC');
const axisC = document.getElementById('axisC');

let B = { mode:null, base:null, condText:'', members:null, symbolic:null, condMeta:null };
let C = { symbolic:null, members:null, meta:null };

/* Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ B */
methodB.addEventListener('change', ()=>{
  const method = methodB.value;
  areaB.innerHTML = '';
  B = { mode:method, base:null, condText:'', members:null, symbolic:null, condMeta:null };
  if(method==='symbolic'){
    areaB.innerHTML = `
      <label>Ø¹Ø¶Ùˆ Ú©Ø¯Ø§Ù… Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ Ø§Ø³ØªØŸ</label>
      <select id="baseB">
        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
        <option value="N">â„•</option>
        <option value="Z">â„¤</option>
        <option value="W">ğ•</option>
        <option value="Q">â„š</option>
        <option value="R">â„</option>
        <option value="irr">Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯</option>
      </select>
      <label>Ø¯Ø± ØµÙˆØ±Øª Ø¯Ø§Ø´ØªÙ† Ø´Ø±Ø· (ÙØ§Ø±Ø³ÛŒ):</label>
      <input id="condB" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ú©ÙˆÚ†Ú©ØªØ± Ø§Ø² 6 ÛŒØ§ Ø²ÙˆØ¬">
      <div class="small">Ù¾Ø³ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ø±ÙˆÛŒ Â«Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ BÂ» Ú©Ù„ÛŒÚ© Ú©Ù†.</div>
      <div style="margin-top:8px" class="row">
        <button id="previewB">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ B</button>
      </div>
      <div id="previewAreaB" style="margin-top:8px"></div>
    `;
    document.getElementById('previewB').addEventListener('click', ()=>{
      const base = document.getElementById('baseB').value;
      const cond = document.getElementById('condB').value.trim();
      if(!base){ alert('Ø§Ø¨ØªØ¯Ø§ Ù¾Ø§ÛŒÙ‡Ù” Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†'); return; }
      const parsed = cond ? parsePersianCondition(cond) : {ok:false};
      B.base = base; B.condText = cond; B.condMeta = parsed.meta || null;
      B.symbolic = cond ? `B = { x âˆˆ ${base} | ${parsed.symbolic || cond} }` : `B = { x âˆˆ ${base} }`;
      // members
      if(['N','W','Z'].includes(base)){
        let sample = baseSamples;
        if(parsed.ok && parsed.predicate) B.members = sample.filter(parsed.predicate);
        else B.members = sample;
      } else {
        B.members = null;
      }
      document.getElementById('previewAreaB').innerHTML = `<div><strong>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´:</strong> <div style="direction:ltr;margin-top:6px">${B.symbolic}</div></div>`;
    });
  }
  else if(method==='members'){
    areaB.innerHTML = `
      <label>Ø§Ø¹Ø¶Ø§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B Ø±Ø§ Ø¯Ø§Ø®Ù„ Ø¢Ú©ÙˆÙ„Ø§Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: 1,2,3 or 4-7):</label>
      <input id="manualB" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: 1,2,5 ÛŒØ§ 2-6">
      <div class="small" style="margin-top:6px">Ù¾Ø³ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù†ØŒ Ø±ÙˆÛŒ Â«Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ BÂ» Ú©Ù„ÛŒÚ© Ú©Ù†.</div>
      <div style="margin-top:8px"><button id="previewB2">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ B</button></div>
      <div id="previewAreaB2" style="margin-top:8px"></div>
    `;
    document.getElementById('previewB2').addEventListener('click', ()=>{
      const txt = document.getElementById('manualB').value.trim();
      const members = parseExplicit(txt);
      B.mode='members'; B.members = members; B.base=null; B.condText=''; B.symbolic = `B = { ${members.join(', ')} }`;
      document.getElementById('previewAreaB2').innerHTML = `<div><strong>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ B:</strong> { ${members.map(toPersian).join(', ')} }</div>`;
    });
  }
  else if(method==='known'){
    areaB.innerHTML = `
      <label>Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</label>
      <select id="knownB">
        <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
        <option value="N">â„•</option>
        <option value="W">ğ•</option>
        <option value="Z">â„¤</option>
        <option value="Q">â„š</option>
        <option value="R">â„</option>
        <option value="irr">Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯</option>
      </select>
      <div style="margin-top:8px"><button id="previewB3">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ B</button></div>
      <div id="previewAreaB3" style="margin-top:8px"></div>
    `;
    document.getElementById('previewB3').addEventListener('click', ()=>{
      const val = document.getElementById('knownB').value;
      if(!val){ alert('ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†'); return; }
      B.mode='known'; B.base=val; if(; else B.members=null;
      B.symbolic = val==='irr' ? 'B = { Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯ }' : `B = { x âˆˆ ${val} }`;
      document.getElementById('previewAreaB3').innerHTML = `<div><strong>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ B:</strong> <div style="direction:ltr;margin-top:6px">${B.symbolic}</div></div>`;
    });
  }
});

/* ØªØ§Ø¨Ø¹ Ù¾Ø§Ø±Ø³ Ø§Ø¹Ø¶Ø§ÛŒ ØµØ±ÛŒØ­ B */
function parseExplicit(txt){
  if(!txt) return [];
  const s = txt.replace(/[{}\\s]/g,'');
  if(!s) return [];
  const parts = s.split(',');
  const out = new Set();
  parts.forEach(p=>{
    if(/^(-?\\d+)-(-?\\d+)$/.test(p)){
      const m = p.match(/^(-?\\d+)-(-?\\d+)$/);
      const a = parseInt(m[1],10), b = parseInt(m[2],10);
      for(let i=Math.min(a,b); i<=Math.max(a,b); i++) out.add(i);
    } else if(/^(-?\\d+)(\\.\\d+)?$/.test(p)){
      out.add(Number(p));
    }
  });
  return Array.from(out).sort((a,b)=>a-b);
}

/* Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ø¯Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ù‡ (A Ùˆ B) Ùˆ ØªÙˆÙ„ÛŒØ¯ C */
function computeC(){
  // A Ù…Ù…Ú©Ù† Ø§Ø³Øª members Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ù†Ù‡
  let Am = A.members; // may be null
  // For operations we consider only enumerated versions; otherwise show message
  // Build B members if possible
  let Bm = B.members;
  if(B.mode==='symbolic' && B.base && ['N','W','Z'].includes(B.base) && B.members) Bm = B.members;
  // if B.mode known and base N/W/Z then members ok (set earlier)
  // For members mode, B.members set earlier
  const op = opSelect.value;
  resultC.innerHTML = '';
  membersC.classList.add('hidden'); vennC.classList.add('hidden'); axisC.classList.add('hidden');

  // Check if we can enumerate (A and B must be enumerated for set member listing)
  const A_enum = Array.isArray(Am) && Am.length>0;
  const B_enum = Array.isArray(Bm) && Bm.length>0;

  // Helper: set ops
  const toSet = arr=> new Set(arr);
  const inter = (a,b)=> Array.from(new Set(a.filter(x=>b.has(x)))).sort((a,b)=>a-b);
  const uni = (a,b)=> Array.from(new Set([...a,...b])).sort((a,b)=>a-b);
  const diff = (a,b)=> Array.from(new Set(a.filter(x=>!b.has(x)))).sort((a,b)=>a-b);
  const subset = (a,b)=> a.every(x=>b.has(x));

  // Cases where we cannot enumerate: if either A or B is non-enumerable and operation requires listing
  if(['intersection','union','difference','subset','member'].includes(op)){
    // Build C symbolic representation
    let sym = '';
    if(op==='intersection') sym = `C = A \\cap B`;
    if(op==='union') sym = `C = A \\cup B`;
    if(op==='difference') sym = `C = A - B`;
    if(op==='subset') sym = `A \\subseteq B ?`;
    if(op==='member') sym = `? \\in B`;

    // If op is membership, need a number to check; for simplicity we'll check a value 3 if available (or ask)
    let resultSymbolic = sym;
    let membersResult = null;
    let cannotEnum = false;

    // For membership op, prompt user for a value via prompt (simple)
    if(op==='member'){
      const valRaw = prompt('ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶Ùˆ Ø¨ÙˆØ¯Ù† ÙˆØ§Ø±Ø¯ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹ 3):','3');
      if(valRaw===null){ resultC.innerHTML = '<div class="muted">Ø¹Ù…Ù„ÛŒØ§Øª Ù…ØªÙˆÙ‚Ù Ø´Ø¯ (Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯).</div>'; return; }
      const v = Number(valRaw);
      if(isNaN(v)){ resultC.innerHTML = '<div class="danger">Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ú©Ø±Ø¯ÛŒ.</div>'; return; }
      // Determine membership: check B if enumerated or if B is symbolic with known predicate
      let inB = false;
      if(Bm && Array.isArray(Bm)) inB = Bm.includes(v);
      else {
        // try to evaluate B.condText predicate if symbolic
        if(B.mode==='symbolic' && B.condText){
          const parsed = parsePersianCondition(B.condText);
          if(parsed.ok) inB = !!parsed.predicate(v);
          else { resultC.innerHTML = `<div class="danger">Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø´Ø±Ø· B Ø±Ø§ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø¯.</div>`; return; }
        } else {
          resultC.innerHTML = `<div class="danger">Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¹Ø¶Ùˆ Ø¨ÙˆØ¯Ù† Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ú©Ø±Ø¯ (B Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´ Ù†ÛŒØ³Øª).</div>`; return;
        }
      }
      resultC.innerHTML = `<div><strong>Ù†ØªÛŒØ¬Ù‡Ù” Ù†Ù…Ø§Ø¯ÛŒÙ†:</strong> ${toPersian(v)} âˆˆ B = ${inB ? '<strong>Ø¯Ø±Ø³Øª</strong>' : '<strong>Ù†Ø§Ø¯Ø±Ø³Øª</strong>'}</div>`;
      C.symbolic = `${toPersian(v)} âˆˆ B = ${inB}`;
      C.members = null;
      return;
    }

    // For subset: check if A âŠ† B
    if(op==='subset'){
      // Need A and B enumerated or parseable
      if(!A_enum){
        resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´ Ù†ÛŒØ³Øª: Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” A Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´ Ù†ÛŒØ³Øª.</div>`; return;
      }
      if(!B_enum){
        // try to test via predicate if B is symbolic
        if(B.mode==='symbolic' && B.base && B.condText){
          // test each element of A with predicate of B
          const parsed = parsePersianCondition(B.condText);
          if(!parsed.ok){ resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¯Ø± Ø¨Ù‡ ØªØ¹ÛŒÛŒÙ† Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¨ÙˆØ¯Ù† Ù†ÛŒØ³ØªÙ… (Ø´Ø±Ø· B Ù†Ø§Ù…ÙÙ‡ÙˆÙ…).</div>`; return; }
          const yes = A.members.every(x=>parsed.predicate(x));
          resultC.innerHTML = `<div><strong>Ù†ØªÛŒØ¬Ù‡:</strong> A âŠ† B â†’ ${yes?'<strong>Ø¯Ø±Ø³Øª</strong>':'<strong>Ù†Ø§Ø¯Ø±Ø³Øª</strong>'}</div>`;
          C.symbolic = `A âŠ† B = ${yes}`;
          C.members = null;
          return;
        } else {
          resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´ Ù†ÛŒØ³Øª: Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´ Ù†ÛŒØ³Øª.</div>`; return;
        }
      }
      // both enumerated
      const yes = subset(Am, toSet(Bm));
      resultC.innerHTML = `<div><strong>Ù†ØªÛŒØ¬Ù‡:</strong> A âŠ† B â†’ ${yes?'<strong>Ø¯Ø±Ø³Øª</strong>':'<strong>Ù†Ø§Ø¯Ø±Ø³Øª</strong>'}</div>`;
      C.symbolic = `A âŠ† B = ${yes}`;
      C.members = null;
      return;
    }

    // For set operations (union/intersection/difference):
    if(!A_enum && !B_enum){
      resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´ Ù†ÛŒØ³Øª: Ù‡Ø± Ø¯Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ ÛŒØ§ ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´â€ŒØ§Ù†Ø¯ (Ù…Ø«Ù„ â„š ÛŒØ§ â„ ÛŒØ§ Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯).</div>`; return;
    }
    if(!A_enum || !B_enum){
      // try to evaluate using predicate on the enumerated one
      if(A_enum && !B_enum && B.mode==='symbolic' && B.condText){
        const parsed = parsePersianCondition(B.condText);
        if(!parsed.ok){ resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¯Ø± Ø¨Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ÛŒØ³ØªÙ… (Ø´Ø±Ø· B Ù†Ø§Ù…ÙÙ‡ÙˆÙ…).</div>`; return; }
        const setB_fromA = Am.filter(x=>parsed.predicate(x));
        // Now compute using Am and setB_fromA
        if(op==='intersection') membersResult = inter(Am, toSet(setB_fromA));
        if(op==='union') membersResult = uni(Am, toSet(setB_fromA));
        if(op==='difference') membersResult = diff(Am, toSet(setB_fromA));
        resultC.innerHTML = `<div><strong>Ù†Ù…Ø§Ø¯:</strong> C = ${op==='union'?'A \\cup B':op==='intersection'?'A \\cap B':'A - B'}</div>`;
        C.symbolic = op==='union'?'A âˆª B':op==='intersection'?'A âˆ© B':'A - B';
        C.members = membersResult;
        membersC.classList.remove('hidden'); membersC.innerHTML = `<div>{ ${membersResult.map(toPersian).join(', ')} }</div>`;
        return;
      }
      if(B_enum && !A_enum && A.base && A.condText){
        const parsed = parsePersianCondition(A.condText);
        if(!parsed.ok){ resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¯Ø± Ø¨Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ÛŒØ³ØªÙ… (Ø´Ø±Ø· A Ù†Ø§Ù…ÙÙ‡ÙˆÙ…).</div>`; return; }
        const setA_fromB = Bm.filter(x=>parsed.predicate(x));
        if(op==='intersection') membersResult = inter(setA_fromB, toSet(Bm));
        if(op==='union') membersResult = uni(setA_fromB, toSet(Bm));
        if(op==='difference') membersResult = diff(setA_fromB, toSet(Bm));
        C.members = membersResult; membersC.classList.remove('hidden'); membersC.innerHTML = `<div>{ ${membersResult.map(toPersian).join(', ')} }</div>`;
        resultC.innerHTML = `<div><strong>Ù†Ù…Ø§Ø¯:</strong> C = ${C.symbolic = (op==='union'?'A âˆª B':op==='intersection'?'A âˆ© B':'A - B')}</div>`;
        return;
      }
      resultC.innerHTML = `<div class="danger">Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´ Ù†ÛŒØ³Øª â€” ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ ÛŒØ§ Ù‡Ø± Ø¯Ùˆ Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ/ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´ Ù‡Ø³ØªÙ†Ø¯.</div>`; return;
    }

    // both enumerated
    const sA = Am, sBset = toSet(Bm);
    let out = [];
    if(op==='intersection') out = inter(sA, sBset);
    if(op==='union') out = uni(sA, sBset);
    if(op==='difference') out = diff(sA, sBset);
    resultC.innerHTML = `<div><strong>Ù†Ù…Ø§Ø¯:</strong> C = ${C.symbolic = (op==='union'?'A âˆª B':op==='intersection'?'A âˆ© B':'A - B')}</div>`;
    C.members = out;
    membersC.classList.remove('hidden'); membersC.innerHTML = `<div>{ ${out.map(toPersian).join(', ')} }</div>`;
    return;
  }
}

/* Ù†Ù…Ø§ÛŒØ´ Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ C */
btnShowMathC.addEventListener('click', ()=>{
  if(!C.symbolic){ alert('Ø§Ø¨ØªØ¯Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯'); return; }
  resultC.innerHTML = `<div><strong>Ù†Ù…Ø§Ø¯ Ø±ÛŒØ§Ø¶ÛŒ C:</strong><div style="direction:ltr;margin-top:6px">${C.symbolic}</div></div>`;
});

/* Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§ÛŒ C (Ø¯Ø± ØµÙˆØ±Øª Ø§Ù…Ú©Ø§Ù†) */
btnShowMembersC.addEventListener('click', ()=>{
  if(!C.members){ membersC.classList.remove('hidden'); membersC.innerHTML = `<div class="danger">Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” Ø­Ø§ØµÙ„ Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ ÛŒØ§ Ø­Ù‚ÛŒÙ‚ÛŒ/Ú¯ÙˆÛŒØ§/Ú¯Ù†Ú¯ Ø§Ø³ØªØŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¶Ø§ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª.</div>`; return; }
  membersC.classList.remove('hidden'); membersC.innerHTML = `<div>{ ${C.members.map(toPersian).join(', ')} }</div>`;
});

/* Ù†Ù…Ø§ÛŒØ´ ÙˆÙ† Ø¨Ø±Ø§ÛŒ C */
btnShowVennC.addEventListener('click', ()=>{
  vennC.classList.remove('hidden'); vennC.innerHTML = '';
  if(!C.members || C.members.length===0){ vennC.innerHTML = `<div class="danger">Ø§Ù…Ú©Ø§Ù† Ù†Ù…Ø§ÛŒØ´ ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ (Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ ÛŒØ§ ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´ ÛŒØ§ Ø®Ø§Ù„ÛŒ).</div>`; return; }
  const members = C.members.slice(0,40);
  const cx=150, cy=90, r=70;
  let texts='';
  const angleStep = 360/members.length;
  members.forEach((v,i)=>{
    const angle = (angleStep*i-90) * Math.PI/180;
    const x = cx + r*Math.cos(angle);
    const y = cy + r*Math.sin(angle);
    texts += `<text x="${x}" y="${y+4}">${toPersian(v)}</text>`;
  });
  vennC.innerHTML = `<svg width="320" height="200"><circle cx="${cx}" cy="${cy}" r="${r}" stroke="#0077cc" fill="rgba(0,119,204,0.12)"/>${texts}</svg>`;
});

/* Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ C (Ù…Ø§Ù†Ù†Ø¯ A rules) */
btnShowAxisC.addEventListener('click', ()=>{
  axisC.classList.remove('hidden'); axisC.innerHTML='';
  if(!C.members || C.members.length===0){ axisC.innerHTML = `<div class="danger">Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª (Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ ÛŒØ§ ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØ´Ù…Ø§Ø±Ø´).</div>`; return; }
  // treat as numeric finite set
  const arr = C.members.slice().sort((a,b)=>a-b);
  const first = arr[0], last = arr[arr.length-1];
  let points='';
  arr.forEach(v=>{
    const pos = ((v - first)/(last - first || 1))*90 + 5;
    points += `<div style="position:absolute;left:${pos}%;top:6px;text-align:center;">â—<div style="font-size:12px">${toPersian(v)}</div></div>`;
  });
  axisC.innerHTML = `<div style="position:relative;height:80px;border-top:2px solid #333;padding-top:6px;">
      ${points}
      <div style="position:absolute;left:5%;right:5%;top:40px;text-align:center;color:#444">
        <span style="display:inline-block;border:1px solid #aaa;padding:6px;border-radius:6px;background:#fff">Ø§Ø² ${toPersian(first)} ØªØ§ ${toPersian(last)}</span>
      </div>
    </div>`;
});

/* compute button */
btnCompute.addEventListener('click', ()=>{
  // need to ensure B is ready
  if(!methodB.value){ alert('Ø±ÙˆØ´ Ø³Ø§Ø®Øª B Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†'); return; }
  // If B symbolic and not previewed show warning
  if(methodB.value==='symbolic' && !B.base && !B.symbolic){ alert('Ø§Ø¨ØªØ¯Ø§ B Ø±Ø§ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ú©Ù†'); return; }
  if(methodB.value==='members' && (!B.members || B.members.length===0)){ alert('Ø§Ø¨ØªØ¯Ø§ Ø§Ø¹Ø¶Ø§ÛŒ B Ø±Ø§ ÙˆØ§Ø±Ø¯ Ùˆ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ú©Ù†'); return; }
  if(methodB.value==='known' && !B.base){ alert('Ø§Ø¨ØªØ¯Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡Ù” B Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ú©Ù†'); return; }
  // ensure A built
  if(!A.base){ alert('Ø§Ø¨ØªØ¯Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” A Ø±Ø§ Ø¨Ø³Ø§Ø²'); return; }
  computeC();
});

/* ---------- helpers and initialization ---------- */
function resetB(){ B = { mode:null, base:null, condText:'', members:null, symbolic:null, condMeta:null }; C={symbolic:null,members:null,meta:null}; resultC.innerHTML=''; membersC.classList.add('hidden'); vennC.classList.add('hidden'); axisC.classList.add('hidden'); }
methodB.addEventListener('change', ()=>{ resetB(); });

/* ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± ØµÙØ­Ù‡ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù†Ù…ÙˆÙ†Ù‡Ù” Ø§ÙˆÙ„ÛŒÙ‡Ù” A Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ… (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) */
(function init(){
  // optional: prefill A with sample
  baseA.value='N'; condA.value=''; buildA();
})();
</script>
</body>
</html>
